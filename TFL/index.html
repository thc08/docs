<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Documentation (Wiki) for Tasmota"><link href=https://tasmota.github.io/docs/TFL/ rel=canonical><link href=../Tasmota-Application/ rel=prev><link href=../TouchPin/ rel=next><link rel=icon href=../_media/favicon.ico><meta name=generator content="mkdocs-1.5.3, mkdocs-material-9.5.14"><title>TensorFlow Lite - Tasmota</title><link rel=stylesheet href=../assets/stylesheets/main.10ba22f1.min.css><link rel=stylesheet href=../assets/stylesheets/palette.06af60db.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Barlow:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Barlow";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../assets/css/anchor-fix.css><script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script id=__analytics>function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-8J08F8X90S"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-8J08F8X90S",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-8J08F8X90S",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script><script>"undefined"!=typeof __md_analytics&&__md_analytics()</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=blue data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#tensorflow-lite class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=.. title=Tasmota class="md-header__button md-logo" aria-label=Tasmota data-md-component=logo> <img src=../_media/logo.svg alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Tasmota </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> TensorFlow Lite </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=blue data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=blue data-md-color-accent=deep-purple aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg> </label> </form> <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/arendst/tasmota title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> arendst/tasmota </div> </a> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../Features/ class=md-tabs__link> Features </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../ESP32/ class=md-tabs__link> ESP32 </a> </li> <li class=md-tabs__item> <a href=../Integrations/ class=md-tabs__link> Smart Home Integrations </a> </li> <li class=md-tabs__item> <a href=../Supported-Peripherals/ class=md-tabs__link> Peripherals </a> </li> <li class=md-tabs__item> <a href=../Configuration-Procedure-for-New-Devices/ class=md-tabs__link> Supported Devices </a> </li> <li class=md-tabs__item> <a href=../FAQ/ class=md-tabs__link> Help </a> </li> <li class=md-tabs__item> <a href=http://tasmota.github.io/install class=md-tabs__link> Web Installer </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=.. title=Tasmota class="md-nav__button md-logo" aria-label=Tasmota data-md-component=logo> <img src=../_media/logo.svg alt=logo> </a> Tasmota </label> <div class=md-nav__source> <a href=https://github.com/arendst/tasmota title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> arendst/tasmota </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_1> <label class=md-nav__link for=__nav_1 id=__nav_1_label tabindex=0> <span class=md-ellipsis> Home </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_1_label aria-expanded=false> <label class=md-nav__title for=__nav_1> <span class="md-nav__icon md-icon"></span> Home </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=.. class=md-nav__link> <span class=md-ellipsis> News </span> </a> </li> <li class=md-nav__item> <a href=../About/ class=md-nav__link> <span class=md-ellipsis> About </span> </a> </li> <li class=md-nav__item> <a href=../Getting-Started/ class=md-nav__link> <span class=md-ellipsis> Getting Started </span> </a> </li> <li class=md-nav__item> <a href=../Upgrading/ class=md-nav__link> <span class=md-ellipsis> Upgrading </span> </a> </li> <li class=md-nav__item> <a href=../MQTT/ class=md-nav__link> <span class=md-ellipsis> MQTT </span> </a> </li> <li class=md-nav__item> <a href=../Commands/ class=md-nav__link> <span class=md-ellipsis> Commands </span> </a> </li> <li class=md-nav__item> <a href=../Templates/ class=md-nav__link> <span class=md-ellipsis> Templates </span> </a> </li> <li class=md-nav__item> <a href=../Components/ class=md-nav__link> <span class=md-ellipsis> Components </span> </a> </li> <li class=md-nav__item> <a href=../Modules/ class=md-nav__link> <span class=md-ellipsis> Modules </span> </a> </li> <li class=md-nav__item> <a href=../Peripherals/ class=md-nav__link> <span class=md-ellipsis> Peripherals </span> </a> </li> <li class=md-nav__item> <a href=../WebUI/ class=md-nav__link> <span class=md-ellipsis> WebUI </span> </a> </li> <li class=md-nav__item> <a href=../Firmware-Builds/ class=md-nav__link> <span class=md-ellipsis> Firmware Builds </span> </a> </li> <li class=md-nav__item> <a href=../Compile-your-build/ class=md-nav__link> <span class=md-ellipsis> Compiling </span> </a> </li> <li class=md-nav__item> <a href=../Contributing/ class=md-nav__link> <span class=md-ellipsis> Contributing </span> </a> </li> <li class=md-nav__item> <a href=../Download/ class=md-nav__link> <span class=md-ellipsis> Download </span> </a> </li> <li class=md-nav__item> <a href=https://github.com/arendst/Tasmota/discussions/categories/show-and-tell class=md-nav__link> <span class=md-ellipsis> Project Showcase </span> </a> </li> <li class=md-nav__item> <a href=../For-Developers/ class=md-nav__link> <span class=md-ellipsis> For Developers </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex=0> <span class=md-ellipsis> Features </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Features </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Features/ class=md-nav__link> <span class=md-ellipsis> Introduction </span> </a> </li> <li class=md-nav__item> <a href=../ADC/ class=md-nav__link> <span class=md-ellipsis> Analog Pin </span> </a> </li> <li class=md-nav__item> <a href=../ArtNet/ class=md-nav__link> <span class=md-ellipsis> ArtNet DMX </span> </a> </li> <li class=md-nav__item> <a href=../Buttons-and-Switches/ class=md-nav__link> <span class=md-ellipsis> Buttons and Switches </span> </a> </li> <li class=md-nav__item> <a href=../DeepSleep/ class=md-nav__link> <span class=md-ellipsis> DeepSleep </span> </a> </li> <li class=md-nav__item> <a href=../Device-Groups/ class=md-nav__link> <span class=md-ellipsis> Device Groups </span> </a> </li> <li class=md-nav__item> <a href=../Displays/ class=md-nav__link> <span class=md-ellipsis> Displays </span> </a> </li> <li class=md-nav__item> <a href=../Dynamic-Sleep/ class=md-nav__link> <span class=md-ellipsis> Dynamic Sleep </span> </a> </li> <li class=md-nav__item> <a href=../I2CDEVICES/ class=md-nav__link> <span class=md-ellipsis> I2C Devices </span> </a> </li> <li class=md-nav__item> <a href=../I2S-Audio/ class=md-nav__link> <span class=md-ellipsis> I2S Audio </span> </a> </li> <li class=md-nav__item> <a href=../IPv6/ class=md-nav__link> <span class=md-ellipsis> IPv6 </span> </a> </li> <li class=md-nav__item> <a href=../Lights/ class=md-nav__link> <span class=md-ellipsis> Lights </span> </a> </li> <li class=md-nav__item> <a href=../Matter/ class=md-nav__link> <span class=md-ellipsis> Matter </span> </a> </li> <li class=md-nav__item> <a href=../PIR-Motion-Sensors/ class=md-nav__link> <span class=md-ellipsis> PIR Motion Sensors </span> </a> </li> <li class=md-nav__item> <a href=../Power-Monitoring-Calibration/ class=md-nav__link> <span class=md-ellipsis> Power Monitoring Calibration </span> </a> </li> <li class=md-nav__item> <a href=../PWM-dimmer-switch/ class=md-nav__link> <span class=md-ellipsis> PWM Dimmer </span> </a> </li> <li class=md-nav__item> <a href=../Rules/ class=md-nav__link> <span class=md-ellipsis> Rules </span> </a> </li> <li class=md-nav__item> <a href=../Scripting-Language/ class=md-nav__link> <span class=md-ellipsis> Scripting Language </span> </a> </li> <li class=md-nav__item> <a href=../Blinds-and-Shutters/ class=md-nav__link> <span class=md-ellipsis> Shutters and Blinds </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_20> <label class=md-nav__link for=__nav_2_20 id=__nav_2_20_label tabindex=0> <span class=md-ellipsis> Protocol Bridging </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_20_label aria-expanded=false> <label class=md-nav__title for=__nav_2_20> <span class="md-nav__icon md-icon"></span> Protocol Bridging </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../TasmotaClient/ class=md-nav__link> <span class=md-ellipsis> Arduino MCU </span> </a> </li> <li class=md-nav__item> <a href=../Bluetooth/ class=md-nav__link> <span class=md-ellipsis> BLE Gateway </span> </a> </li> <li class=md-nav__item> <a href=../HDMI_CEC/ class=md-nav__link> <span class=md-ellipsis> HDMI CEC </span> </a> </li> <li class=md-nav__item> <a href=../Tasmota-IR/ class=md-nav__link> <span class=md-ellipsis> IR Communication </span> </a> </li> <li class=md-nav__item> <a href=../Projector/ class=md-nav__link> <span class=md-ellipsis> LCD/DLP Projector Control </span> </a> </li> <li class=md-nav__item> <a href=../Modbus-Bridge/ class=md-nav__link> <span class=md-ellipsis> Modbus Bridge </span> </a> </li> <li class=md-nav__item> <a href=../OpenTherm/ class=md-nav__link> <span class=md-ellipsis> OpenTherm </span> </a> </li> <li class=md-nav__item> <a href=../RF-Protocol/ class=md-nav__link> <span class=md-ellipsis> RF Communication </span> </a> </li> <li class=md-nav__item> <a href=../Serial-to-TCP-Bridge/ class=md-nav__link> <span class=md-ellipsis> Serial to TCP Bridge </span> </a> </li> <li class=md-nav__item> <a href=../Zigbee/ class=md-nav__link> <span class=md-ellipsis> Zigbee </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../Smart-Meter-Interface/ class=md-nav__link> <span class=md-ellipsis> Smart Meter Interface </span> </a> </li> <li class=md-nav__item> <a href=../Thermostat/ class=md-nav__link> <span class=md-ellipsis> Thermostat </span> </a> </li> <li class=md-nav__item> <a href=../Timers/ class=md-nav__link> <span class=md-ellipsis> Timers </span> </a> </li> <li class=md-nav__item> <a href=../TLS/ class=md-nav__link> <span class=md-ellipsis> TLS Secured MQTT </span> </a> </li> <li class=md-nav__item> <a href=../TuyaMCU/ class=md-nav__link> <span class=md-ellipsis> TuyaMCU </span> </a> </li> <li class=md-nav__item> <a href=../UFS/ class=md-nav__link> <span class=md-ellipsis> Universal File System </span> </a> </li> <li class=md-nav__item> <a href=../Range-Extender/ class=md-nav__link> <span class=md-ellipsis> Wi-Fi Range Extender </span> </a> </li> <li class=md-nav__item> <a href=../Tutorials/ class=md-nav__link> <span class=md-ellipsis> Projects and Tutorials </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3 checked> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex> <span class=md-ellipsis> ESP32 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=true> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> ESP32 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../ESP32/ class=md-nav__link> <span class=md-ellipsis> Tasmota32 Features </span> </a> </li> <li class=md-nav__item> <a href=../Berry/ class=md-nav__link> <span class=md-ellipsis> Berry </span> </a> </li> <li class=md-nav__item> <a href=../Bluetooth_ESP32/ class=md-nav__link> <span class=md-ellipsis> Bluetooth Low Energy </span> </a> </li> <li class=md-nav__item> <a href=../LVGL/ class=md-nav__link> <span class=md-ellipsis> LVGL </span> </a> </li> <li class=md-nav__item> <a href=../HASPmota/ class=md-nav__link> <span class=md-ellipsis> HASPmota </span> </a> </li> <li class=md-nav__item> <a href=../Matter/ class=md-nav__link> <span class=md-ellipsis> Matter </span> </a> </li> <li class=md-nav__item> <a href=../Tasmota-Application/ class=md-nav__link> <span class=md-ellipsis> Tasmota Application Files </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> TensorFlow Lite </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> TensorFlow Lite </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#different-levels-of-tensorflow class=md-nav__link> <span class=md-ellipsis> Different Levels of TensorFlow </span> </a> </li> <li class=md-nav__item> <a href=#machine-learning-is-what-exactly-again class=md-nav__link> <span class=md-ellipsis> Machine Learning ... is what exactly again? </span> </a> </li> <li class=md-nav__item> <a href=#design-considerations-for-tasmota class=md-nav__link> <span class=md-ellipsis> Design Considerations for Tasmota </span> </a> <nav class=md-nav aria-label="Design Considerations for Tasmota"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#speech-recognition class=md-nav__link> <span class=md-ellipsis> Speech Recognition </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#usage class=md-nav__link> <span class=md-ellipsis> Usage </span> </a> <nav class=md-nav aria-label=Usage> <ul class=md-nav__list> <li class=md-nav__item> <a href=#hello-world-sort-of class=md-nav__link> <span class=md-ellipsis> "Hello World" Sort Of... </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#speech-recognition-keyword-spotting class=md-nav__link> <span class=md-ellipsis> Speech Recognition / Keyword Spotting </span> </a> <nav class=md-nav aria-label="Speech Recognition / Keyword Spotting"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#create-training-data class=md-nav__link> <span class=md-ellipsis> Create Training Data </span> </a> </li> <li class=md-nav__item> <a href=#general-strategies class=md-nav__link> <span class=md-ellipsis> General strategies </span> </a> </li> <li class=md-nav__item> <a href=#edge-impulse class=md-nav__link> <span class=md-ellipsis> Edge Impulse </span> </a> </li> <li class=md-nav__item> <a href=#tasmota-side class=md-nav__link> <span class=md-ellipsis> Tasmota Side </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../TouchPin/ class=md-nav__link> <span class=md-ellipsis> Touch GPIOs </span> </a> </li> <li class=md-nav__item> <a href=../Safeboot/ class=md-nav__link> <span class=md-ellipsis> Safeboot Partition Layout </span> </a> </li> <li class=md-nav__item> <a href=https://templates.blakadder.com/esp32 class=md-nav__link> <span class=md-ellipsis> Supported Devices </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex=0> <span class=md-ellipsis> Smart Home Integrations </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Smart Home Integrations </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Integrations/ class=md-nav__link> <span class=md-ellipsis> Introduction </span> </a> </li> <li class=md-nav__item> <a href=../Alexa/ class=md-nav__link> <span class=md-ellipsis> Alexa </span> </a> </li> <li class=md-nav__item> <a href=../AWS-IoT/ class=md-nav__link> <span class=md-ellipsis> AWS IoT </span> </a> </li> <li class=md-nav__item> <a href=../Domoticz/ class=md-nav__link> <span class=md-ellipsis> Domoticz </span> </a> </li> <li class=md-nav__item> <a href=../Home-Assistant/ class=md-nav__link> <span class=md-ellipsis> Home Assistant </span> </a> </li> <li class=md-nav__item> <a href=../Homebridge/ class=md-nav__link> <span class=md-ellipsis> Homebridge </span> </a> </li> <li class=md-nav__item> <a href=https://homey.app/en-us/app/com.paveld.tasmota/Tasmota-MQTT/ class=md-nav__link> <span class=md-ellipsis> Homey </span> </a> </li> <li class=md-nav__item> <a href=../HomeSeer/ class=md-nav__link> <span class=md-ellipsis> HomeSeer </span> </a> </li> <li class=md-nav__item> <a href=../IP-Symcon/ class=md-nav__link> <span class=md-ellipsis> IP Symcon </span> </a> </li> <li class=md-nav__item> <a href=../KNX/ class=md-nav__link> <span class=md-ellipsis> KNX </span> </a> </li> <li class=md-nav__item> <a href=../NodeRed/ class=md-nav__link> <span class=md-ellipsis> NodeRed </span> </a> </li> <li class=md-nav__item> <a href=../nymea/ class=md-nav__link> <span class=md-ellipsis> nymea </span> </a> </li> <li class=md-nav__item> <a href=../Octoprint/ class=md-nav__link> <span class=md-ellipsis> OctoPrint </span> </a> </li> <li class=md-nav__item> <a href=../openHAB/ class=md-nav__link> <span class=md-ellipsis> openHAB </span> </a> </li> <li class=md-nav__item> <a href=../otto/ class=md-nav__link> <span class=md-ellipsis> Otto </span> </a> </li> <li class=md-nav__item> <a href=https://github.com/arendst/Tasmota/issues/3769 class=md-nav__link> <span class=md-ellipsis> IOBroker </span> </a> </li> <li class=md-nav__item> <a href=https://github.com/tim-hellhake/tasmota-adapter class=md-nav__link> <span class=md-ellipsis> Mozilla WebThings Adapter </span> </a> </li> <li class=md-nav__item> <a href=https://github.com/hongtat/tasmota-connect class=md-nav__link> <span class=md-ellipsis> SmartThings </span> </a> </li> <li class=md-nav__item> <a href=https://github.com/Gifford47/tasmohab/blob/master/README.md class=md-nav__link> <span class=md-ellipsis> Tasmohab </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../Supported-Peripherals/ class=md-nav__link> <span class=md-ellipsis> Peripherals </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6 id=__nav_6_label tabindex=0> <span class=md-ellipsis> Supported Devices </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_6_label aria-expanded=false> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Supported Devices </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Configuration-Procedure-for-New-Devices/ class=md-nav__link> <span class=md-ellipsis> Configure Unknown Device </span> </a> </li> <li class=md-nav__item> <a href="https://templates.blakadder.com/ " target='_blank""' class=md-nav__link> <span class=md-ellipsis> All Supported Devices </span> </a> </li> <li class=md-nav__item> <a href=../Pinouts/ class=md-nav__link> <span class=md-ellipsis> Wi-Fi Module Pinouts </span> </a> </li> <li class=md-nav__item> <a href=../Supported-Modules/ class=md-nav__link> <span class=md-ellipsis> Supported Modules </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7> <label class=md-nav__link for=__nav_7 id=__nav_7_label tabindex=0> <span class=md-ellipsis> Help </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_7_label aria-expanded=false> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> Help </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../FAQ/ class=md-nav__link> <span class=md-ellipsis> FAQ </span> </a> </li> <li class=md-nav__item> <a href=../Troubleshooting/ class=md-nav__link> <span class=md-ellipsis> Troubleshooting </span> </a> </li> <li class=md-nav__item> <a href=../Device-Recovery/ class=md-nav__link> <span class=md-ellipsis> Device Recovery </span> </a> </li> <li class=md-nav__item> <a href="https://discord.gg/Ks2Kzd4 " target='_blank""' class=md-nav__link> <span class=md-ellipsis> Discord Support </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=http://tasmota.github.io/install class=md-nav__link> <span class=md-ellipsis> Web Installer </span> </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#different-levels-of-tensorflow class=md-nav__link> <span class=md-ellipsis> Different Levels of TensorFlow </span> </a> </li> <li class=md-nav__item> <a href=#machine-learning-is-what-exactly-again class=md-nav__link> <span class=md-ellipsis> Machine Learning ... is what exactly again? </span> </a> </li> <li class=md-nav__item> <a href=#design-considerations-for-tasmota class=md-nav__link> <span class=md-ellipsis> Design Considerations for Tasmota </span> </a> <nav class=md-nav aria-label="Design Considerations for Tasmota"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#speech-recognition class=md-nav__link> <span class=md-ellipsis> Speech Recognition </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#usage class=md-nav__link> <span class=md-ellipsis> Usage </span> </a> <nav class=md-nav aria-label=Usage> <ul class=md-nav__list> <li class=md-nav__item> <a href=#hello-world-sort-of class=md-nav__link> <span class=md-ellipsis> "Hello World" Sort Of... </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#speech-recognition-keyword-spotting class=md-nav__link> <span class=md-ellipsis> Speech Recognition / Keyword Spotting </span> </a> <nav class=md-nav aria-label="Speech Recognition / Keyword Spotting"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#create-training-data class=md-nav__link> <span class=md-ellipsis> Create Training Data </span> </a> </li> <li class=md-nav__item> <a href=#general-strategies class=md-nav__link> <span class=md-ellipsis> General strategies </span> </a> </li> <li class=md-nav__item> <a href=#edge-impulse class=md-nav__link> <span class=md-ellipsis> Edge Impulse </span> </a> </li> <li class=md-nav__item> <a href=#tasmota-side class=md-nav__link> <span class=md-ellipsis> Tasmota Side </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/tasmota/docs/blob/master/docs/TFL.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4v-2m10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1 2.1 2.1Z"/></svg> </a> <h1 id=tensorflow-lite>TensorFlow Lite <span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9 3v2H7a2 2 0 0 0-2 2v2H3v2h2v2H3v2h2v2a2 2 0 0 0 2 2h2v2h2v-2h2v2h2v-2h2a2 2 0 0 0 2-2v-2h2v-2h-2v-2h2V9h-2V7a2 2 0 0 0-2-2h-2V3h-2v2h-2V3M7 9h3.5a1 1 0 0 1 1 1v4a1 1 0 0 1-1 1H7v-1.5h3v-.75H8.5v-1.5H10v-.75H7M12.5 9H16a1 1 0 0 1 1 1v1.75a1 1 0 0 1-1 1h-2v.75h3V15h-4.5v-2.75a1 1 0 0 1 1-1h2v-.75h-3"/></svg></span><a class=headerlink href=#tensorflow-lite title="Permanent link">~</a></h1> <details class=failure> <summary>This feature is not included in precompiled binaries</summary> <p>add as a build flag to your build environment in <code>platformio_tasmota_cenv.ini</code>:<br> <div class=highlight><pre><span></span><code>build_flags             = ${env:tasmota32_base.build_flags}
                        -DUSE_BERRY_TF_LITE
                        -DESP_NN ; use optimized kernels for ESP32
                        -DUSE_I2S ; add only for speech/microphone use
lib_extra_dirs          = lib/libesp32, lib/libesp32_div, lib/lib_basic, lib/lib_i2c, lib/lib_div, lib/lib_ssl, lib/libesp32_ml
; lib/libesp32_ml is important to include 
</code></pre></div></p> </details> <h2 id=different-levels-of-tensorflow>Different Levels of TensorFlow<a class=headerlink href=#different-levels-of-tensorflow title="Permanent link">~</a></h2> <p><a href=https://www.tensorflow.org>TensorFlow</a> is an open-source machine-learning platform that is widely adopted and thus is a whole ecosystem with tools, libraries and a huge community. It is not application specific and can be used for all kind of tasks.<br> Initially it was only usable on fully fledged computers but over time technical advances in software and hardware made it possible to step down the stairs and make it usable on weaker devices.<br> So the next smaller thing is called <a href=https://www.tensorflow.org/lite>TensorFlow Lite</a> that was targeted for smaller devices like the famous ARM-based 'RaspberryPi'. </p> <p>But - you guessed it - this was not the end of the line and the whole armada of microcontrollers reached out to be part of the machine learning world. The name of this stripped down platform is <a href=https://www.tensorflow.org/lite/microcontrollers>TensorFlow Lite for Microcontrollers</a>.<br> Tasmota uses a <a href=https://github.com/espressif/esp-nn>fork</a> from Espressif with optimized functions for maximal performance. </p> <h2 id=machine-learning-is-what-exactly-again>Machine Learning ... is what exactly again?<a class=headerlink href=#machine-learning-is-what-exactly-again title="Permanent link">~</a></h2> <p>Machine learning, deep learning, KI, AI, ... - these are very blurry defined words, that mean more or less the same and scale from pretty complex up to extremely complex software constructs. Let's try to have a very simplified look at it.</p> <p>In ancient times (like 20 years ago) problems where solved on computers by finding an algorithm to compute input data and thus getting output data.<br> With machine learning the process is still to have input data, but to use known good output data to let a piece of software find the algorithm to get from the known input data to the known output data - and hope that this still works with unknown input data.<br> The mixture of algorithms and found parameters will be put into a structure which is called a <em>model</em> and the process of building it is usually named <em>training</em>.<br> The model is created programmatically, although this process can be hidden behind a GUI and at this stage the number of inputs and outputs will be defined.<br> Although it would be technically possible to feed raw sensor data into the model, this is not how it is done in most cases. The very common step in between is called <em>feature extraction</em>, which reduces the amount of data and often the dimensionality to make the whole process more efficient and thus even possible for some applications. A good feature extraction will help to later run a successful <em>inference</em> and there are tools to show, how different input entities form clusters of feature data.<br> After feeding the model with sensible data it is time to press a virtual "go button" and invoke an <em>inference</em>, that does the magic computations inside the <em>model</em>.<br> After that the <em>outputs</em> will get populated with some values, that have to be interpreted as probabilities. It can be required to add some complex logic in order interpret this data or do some averaging of real-time data. </p> <p>The processed data is historically typically in the floating point format, but for weak devices like MCU's it is a very common thing to shrink the 4 bytes of a <em>float32</em> to 1 byte of an <em>int8</em> by quantization. This happens on various places and will lead to a loss of precision, but is very often nearly on par in the final result. </p> <h2 id=design-considerations-for-tasmota>Design Considerations for Tasmota<a class=headerlink href=#design-considerations-for-tasmota title="Permanent link">~</a></h2> <p>The understandable way to optimize machine learning applications for MCU's is to build and later flash one monolithic firmware, where everything has to be done at/before compile time. This makes sense and is fundamentally the only way to quench out every little bit of performance and memory optimization. </p> <p>Nonetheless for Tasmota we do not really want to build one-trick-pony firmwares and the idea is to be able to run all kinds of TensorFlow applications with one firmware, that has enough generic capabilities to dynamically load models and extra code at runtime. On the other hand we can optimize the program flow for the ESP chips and Free-RTOS.<br> The API shall be quite slim with as few boilerplate code as possible, but can be extended as needed and use Berry to add additional logic in the first place. </p> <div class="admonition tip"> <p class=admonition-title>Accelerate your development workflow for machine learning</p> <p>Usually developing machine learning applications on MCU's means that every small change to the model and/or application code will need a firmware compilation and flashing.<br> With Tasmota this is now independent to each other. You can retrain and reupload the model to the file system as often as needed at runtime. The same is valid for refining the Berry code.</p> </div> <p>In order to get things done like speech recognition, where especially realtime feature extraction is not possible to achieve with Berry (with the knowledge of today), additional specialized functionality is included.<br> Where it makes sense helper functions for capturing data are added too. </p> <div class="admonition failure"> <p class=admonition-title>Before you proceed, check you expectations!!</p> <p>The most important prerequisite for speech recognition on MCU's is to have the right mindset. It is totally impossible to reach the level of recognition of a commercial product (Alexa, Siri, Cortana, ... you name it) on much stronger hardware. The usual cheap I2S MEMS microphone alone is a severe problem and the tuning of the various variables of the model is trial and error in many cases. It will make the final application fail with wrong but similar sounding words or mumbling. <br> Be happy if it works and just don't do it, if you can not handle frustration! You will have to invest some time to fine tune every specific application!</p> </div> <p>This sums up to these steps: </p> <ol> <li> <p>Create a TensorFlow lite model (including collecting data, finding good parameters, final training). Use Edgeimpulse to make this easy or create your own training pipeline.</p> </li> <li> <p>Create a Berry application (loading the model, running inference, interpret the result, acting on the result). Use building blocks from this page to get started.</p> </li> </ol> <h3 id=speech-recognition>Speech Recognition<a class=headerlink href=#speech-recognition title="Permanent link">~</a></h3> <p>For the specific task of speech recognition a big hurdle lies in the way in the form of "How to create a model"?. Although there are numerous ways published on various places, that sound quite similar to each other, this is a very non-trivial task.<br> While the same principles apply to all examples that you may find, the implementation differences under the hood are quite substantial.<br> The hardest part here is to do the <em>feature extraction</em> of the audio data in a compatible(!!!) way for training and inference on the device. Usually the raw audio data is processed using mel frequency conversion, FFT and some kind of logarithm. You may find words like power spectrum, mel frequency energies and mel frequency cepstral coefficients, which sadly are very implementation specific and not interchangeable.<br> So it is utterly important to use the same (= compatible) implementations for the whole pipeline of <code>Training-&gt;Deployment-&gt;Usage</code>. </p> <p>For convenience reasons and after extended testing it was decided to be compatible with <a href=https://github.com/astorfi/speechpy>Speechpy</a> (with small differences). Thus it is possible to use <a href=https://www.edgeimpulse.com>Edge Impulse</a> as the training platform for model creation, which uses <em>Speechpy</em> too and is a development platform for machine learning on small devices, that shares some similarities to GitHub with regards to costs. Everything that we need for Tasmota is free, the enterprise solution they offer for money is not needed.<br> Technically it is definitely possible to build a complete offline training pipeline as basically everything on Edgeimpulse is open source and can be recreated by a motivated user for local usage. </p> <p>If you use <a href=https://www.edgeimpulse.com>Edge Impulse</a> for online training, you do not have to create a new firmware image for your Tasmota device. Instead of choosing one of the deployment options from Edge Impulse, you only have to download the binary TensorFlow Lite model (usually the <code>int8 quantized</code> version) from the <code>Dashboard</code>, give it a suitable name and upload it to Tasmotas filesystem in order to use it with Berry afterwards. </p> <figcaption>Example - speech recognition using MFCC:</figcaption> <p><img alt="Feature parameters" src=../_media/ml/download.png width=500></p> <h2 id=usage>Usage<a class=headerlink href=#usage title="Permanent link">~</a></h2> <p>Functionality is provided by the module <code>TFL</code>, so always start with <code>import TFL</code>.</p> <table> <thead> <tr> <th style="text-align: left;">TFL Function</th> <th style="text-align: left;">Parameters and details</th> </tr> </thead> <tbody> <tr> <td style="text-align: left;">begin<a class=cmnd id=tfl_begin></td> <td style="text-align: left;"><code>(type:string, descriptor:bytes)</code><br>First step creates an internal context of type<br>"BUF" - generic session with arbitrary byte buffers for input and output<br>"MIC" - for voice recognition and capturing training data<br>"CAM" - not implemented yet<br>"" - stops a running session, can be used to init the internal log buffer<br><code>`descriptor</code>a byte array with specific meaning for every type</td> </tr> <tr> <td style="text-align: left;">load<a class=cmnd id=tfl_begin></td> <td style="text-align: left;"><code>(model:bytes, output:bytes, memory:int)</code><br>Will load and run the model<br><code>model</code> a bytes buffer that holds the model data for the entire lifecycle<br><code>output</code> a byte buffer that matches the output size of the model<br><code>memory</code> optional (default: 2000), a model specific memory size in bytes that will be allocated, find by trial-end-error</td> </tr> <tr> <td style="text-align: left;">input<a class=cmnd id=tfl_input></td> <td style="text-align: left;"><code>(input:bytes)</code><br>Feed the input of the model with values, must match the size of the model input. Will invoke an inference.</td> </tr> <tr> <td style="text-align: left;">output<a class=cmnd id=tfl_output></td> <td style="text-align: left;"><code>(output:bytes) -&gt; bool</code><br>Returns true if function was not called yet on actual output data.</td> </tr> <tr> <td style="text-align: left;">rec<a class=cmnd id=tfl_rec></td> <td style="text-align: left;"><code>(filename:string, seconds:int)</code><br>Records audio to a WAV file (Mono, 16 kHz, 16 Bit).</td> </tr> <tr> <td style="text-align: left;">stats<a class=cmnd id=tfl_stats></td> <td style="text-align: left;"><code>() -&gt; string</code><br>Returns a JSON string with some metrics of the current session.</td> </tr> <tr> <td style="text-align: left;">log<a class=cmnd id=tfl_log></td> <td style="text-align: left;"><code>() -&gt; string</code><br>Returns a log message, typically for debugging.</td> </tr> </tbody> </table> <div class="admonition tip"> <p class=admonition-title>Use Netron to check your model</p> <p><a href=https://netron.app>https://netron.app</a> shows the inner structure of a tensorflow model including format and size of the inputs and outputs. Online and offline versions of the application available for every major platform.</p> </div> <h3 id=hello-world-sort-of>"Hello World" Sort Of...<a class=headerlink href=#hello-world-sort-of title="Permanent link">~</a></h3> <p>Perhaps THE starter project is the in itself pretty useless "sinewave example", which is nicely explained <a href="https://www.youtube.com/watch?v=BzzqYNYOcWc&t=2s">in these videos</a>.</p> <p>Of course we can run this model perfectly fine inside Tasmota, with a Berry code snippet:</p> <div class=highlight><pre><span></span><code><span class=kr>import</span><span class=w> </span><span class=n>TFL</span>
<span class=n>TFL</span><span class=p>.</span><span class=nf>begin</span><span class=p>(</span><span class=s2>&quot;BUF&quot;</span><span class=p>)</span><span class=w>  </span><span class=c1># generic TFL session </span>
<span class=kd>var</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>bytes</span><span class=p>(</span><span class=mi>-4</span><span class=p>)</span><span class=w> </span><span class=c1># holds one float, size must match the model</span>
<span class=kd>var</span><span class=w> </span><span class=n>o</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>bytes</span><span class=p>(</span><span class=mi>-4</span><span class=p>)</span><span class=w> </span><span class=c1># dito</span>

<span class=kd>var</span><span class=w> </span><span class=n>model</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>open</span><span class=p>(</span><span class=s2>&quot;sine_model.tflite&quot;</span><span class=p>).</span><span class=nf>readbytes</span><span class=p>()</span><span class=w> </span><span class=c1># this binary file must have been saved in the FS before</span>
<span class=n>TFL</span><span class=p>.</span><span class=nf>load</span><span class=p>(</span><span class=n>model</span><span class=p>,</span><span class=n>o</span><span class=p>,</span><span class=mi>3000</span><span class=p>)</span><span class=w> </span><span class=c1># load and run</span>

<span class=kd>var</span><span class=w> </span><span class=n>count</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=mf>.0</span>
<span class=kd>def</span><span class=w> </span><span class=nf>cb</span><span class=p>()</span><span class=w> </span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=n>TFL</span><span class=p>.</span><span class=nf>output</span><span class=p>(</span><span class=n>o</span><span class=p>)</span>
<span class=w>        </span><span class=c1># &quot;draw&quot; a bar</span>
<span class=w>        </span><span class=kd>var</span><span class=w> </span><span class=n>v</span><span class=w> </span><span class=o>=</span><span class=w>  </span><span class=nb>int</span><span class=p>((</span><span class=n>o</span><span class=p>.</span><span class=nf>getfloat</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mi>1</span><span class=p>)</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=mi>15</span><span class=p>)</span>
<span class=w>        </span><span class=kd>var</span><span class=w> </span><span class=n>bar_el</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;=&quot;</span>
<span class=w>        </span><span class=kd>var</span><span class=w> </span><span class=n>bar</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;&quot;</span>
<span class=w>        </span><span class=k>for</span><span class=w> </span><span class=n>i</span><span class=o>:</span><span class=mi>0</span><span class=o>..</span><span class=na>v</span><span class=w> </span><span class=n>bar</span><span class=o>+=</span><span class=n>bar_el</span><span class=w> </span><span class=k>end</span>
<span class=w>        </span><span class=nb>print</span><span class=p>(</span><span class=n>bar</span><span class=p>)</span>

<span class=w>        </span><span class=c1># or print the value</span>
<span class=w>        </span><span class=c1># print(o.getfloat(0))</span>

<span class=w>        </span><span class=c1># prepare new input in the range of 0..6</span>
<span class=w>        </span><span class=n>count</span><span class=o>+=</span><span class=w> </span><span class=mi>0</span><span class=mf>.1</span><span class=w> </span>
<span class=w>        </span><span class=k>if</span><span class=w> </span><span class=n>count</span><span class=o>&gt;</span><span class=mi>6</span><span class=w> </span><span class=n>count</span><span class=o>=</span><span class=mi>0</span><span class=w> </span><span class=k>end</span>
<span class=w>        </span><span class=n>i</span><span class=p>.</span><span class=nf>setfloat</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=n>count</span><span class=p>)</span><span class=w> </span>
<span class=w>        </span><span class=n>TFL</span><span class=p>.</span><span class=nb>input</span><span class=p>(</span><span class=n>i</span><span class=p>)</span><span class=w> </span><span class=c1># and feed it into the model</span>
<span class=w>    </span><span class=k>end</span>
<span class=w>    </span><span class=kd>var</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>TFL</span><span class=p>.</span><span class=nf>log</span><span class=p>()</span><span class=w> </span><span class=c1># receive log messages from the TF lite tasks</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=nb>print</span><span class=p>(</span><span class=n>s</span><span class=p>)</span><span class=w> </span><span class=k>end</span><span class=w> </span>
<span class=w>    </span><span class=n>tasmota</span><span class=p>.</span><span class=nf>set_timer</span><span class=p>(</span><span class=mi>50</span><span class=p>,</span><span class=w> </span><span class=n>cb</span><span class=p>)</span><span class=w> </span>
<span class=k>end</span>
<span class=nf>cb</span><span class=p>()</span>

<span class=c1># initiate loop </span>
<span class=n>TFL</span><span class=p>.</span><span class=nb>input</span><span class=p>(</span><span class=n>i</span><span class=p>)</span>
</code></pre></div> <p>This will pollute your Tasmota console with a moving bar resembling a sine wave.</p> <p>In fact this shows a very generic application, where the format and size as well as the meaning of the in- and outputs must be known, but the model itself can remain a "black box". We do not need to know, which kernels or parameters are used. </p> <div class="admonition tip"> <p class=admonition-title>Use 'TFL.stats()' to find memory size</p> <p>The metrics will show the used bytes of the model. So start with a large value and tune down, but leave a margin above the number in the output of the command.</p> </div> <h2 id=speech-recognition-keyword-spotting>Speech Recognition / Keyword Spotting<a class=headerlink href=#speech-recognition-keyword-spotting title="Permanent link">~</a></h2> <p>Training can be done entirely with Edgeimpulse. See their documentation for <a href=https://docs.edgeimpulse.com/docs/tutorials/responding-to-your-voice>Responding to your voice</a>. </p> <p>It is important to have a basic understanding of the process of speech recognition in order to set and tune the configuration:<br> An audio stream is processed in small slices, which have a duration and a stride. They can overlap or run one after the other. </p> <p>Tasmota will process every audio slice and immediately extract the features with support for the modes: <a href="https://docs.edgeimpulse.com/docs/edge-impulse-studio/processing-blocks/audio-mfe?q=mfe">MFE</a> and <a href="https://docs.edgeimpulse.com/docs/edge-impulse-studio/processing-blocks/audio-mfcc?q=mfe">MFCC</a>.<br> For performance reasons, we do not support every setting Edgeimpulse provides. Do not use <code>Window size</code> for MFCC mode by setting it to 0. More on this later.</p> <p>We use the following fixed audio settings: </p> <table> <thead> <tr> <th style="text-align: left;">Setting</th> <th style="text-align: left;">Value</th> </tr> </thead> <tbody> <tr> <td style="text-align: left;">Sample length</td> <td style="text-align: left;">1 second - means the word to train should be shorter (you might get away with training a shorter part of a longer word)</td> </tr> <tr> <td style="text-align: left;">Sample frequency</td> <td style="text-align: left;">16kHz - a proven compromise of sound quality, that is just enough for voice recognition, but can be handled by the ESP32</td> </tr> <tr> <td style="text-align: left;">Sample format</td> <td style="text-align: left;">16 bit, mono</td> </tr> <tr> <td style="text-align: left;">Low frequency</td> <td style="text-align: left;">300 Hz - default in Edgeimpulse</td> </tr> <tr> <td style="text-align: left;">High frequency</td> <td style="text-align: left;">8000 Hz - Sample frequency/2 and default too. Higher values would not make sense because of the NYQUIST theorem.</td> </tr> </tbody> </table> <h3 id=create-training-data>Create Training Data<a class=headerlink href=#create-training-data title="Permanent link">~</a></h3> <p>A working microphone setup for recording training data and later audio recognition is needed. </p> <p>Therefor the <code>-DUSE_I2S</code> must be defined in the <code>build_flags:</code> section of the environment in <code>platformio_tasmota_cenv.ini</code>. This allows to set the GPIO pins for the I2S microphone according to <a href=../I2S-Audio/ >I2S-Audio</a>. </p> <p>Although you can use the microphone of your computer or smartphone, it is highly recommended to use your ESP32 microphone at least for a large amount of samples in order to train the model with the same pure sound quality, that it later has to run inference on. A working SD card config is the best way to capture training data.</p> <p>You can use a simple Berry driver to get this done: </p> <div class=highlight><pre><span></span><code><span class=c1># record to 16-bit WAV file at 16 kHz, SD card highly recommended</span>
<span class=c1># repeat the intended keyword roughly every second in the same technical setup, that will later be used for keyword spotting</span>
<span class=c1># usage &#39;rec&lt;seconds&gt; filename&#39;, example: rec30 left -&gt; record 30 seconds from I2S microphone to &#39;/left.wav&#39;</span>
<span class=kd>class</span><span class=w> </span><span class=nc>WAV_REC</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>Driver</span>
<span class=w>    </span><span class=kd>var</span><span class=w> </span><span class=n>secs</span>

<span class=w>    </span><span class=kd>def</span><span class=w> </span><span class=nf>init</span><span class=p>()</span>
<span class=w>        </span><span class=kr>import</span><span class=w> </span><span class=n>TFL</span>
<span class=w>        </span><span class=n>TFL</span><span class=p>.</span><span class=nf>begin</span><span class=p>(</span><span class=s2>&quot;&quot;</span><span class=p>)</span><span class=w> </span><span class=c1># init empty for log buffer</span>
<span class=w>        </span><span class=nb>print</span><span class=p>(</span><span class=s2>&quot;TFL: command &#39;rec&#39; added&quot;</span><span class=p>)</span>
<span class=w>        </span><span class=kr>self</span><span class=p>.</span><span class=na>secs</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span>
<span class=w>    </span><span class=k>end</span>

<span class=w>    </span><span class=kd>def</span><span class=w> </span><span class=nf>begin</span><span class=p>()</span>
<span class=w>        </span><span class=kr>import</span><span class=w> </span><span class=n>TFL</span>
<span class=w>        </span><span class=kd>var</span><span class=w> </span><span class=n>descriptor</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>bytes</span><span class=p>(</span><span class=mi>-10</span><span class=p>)</span><span class=w> </span><span class=c1># mic descriptor</span>
<span class=w>        </span><span class=n>descriptor</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>4</span><span class=w>  </span><span class=c1># i2s_channel_fmt, 4=left</span>
<span class=w>        </span><span class=n>descriptor</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>16</span><span class=w> </span><span class=c1># amplification factor</span>
<span class=w>        </span><span class=n>descriptor</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>32</span><span class=w> </span><span class=c1># slice_dur</span>
<span class=w>        </span><span class=n>descriptor</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>32</span><span class=w> </span><span class=c1># slice_stride</span>
<span class=w>        </span><span class=n>descriptor</span><span class=p>[</span><span class=mi>4</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>40</span><span class=w> </span><span class=c1># mfe filter (= features if MFE mode)</span>
<span class=w>        </span><span class=n>descriptor</span><span class=p>[</span><span class=mi>5</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=w>  </span><span class=c1># mfcc coefficients, if 0 -&gt; compute MFE only</span>
<span class=w>        </span><span class=n>descriptor</span><span class=p>[</span><span class=mi>6</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>9</span><span class=w>  </span><span class=c1># 2^9 = 512 fft_bins</span>
<span class=w>        </span><span class=n>descriptor</span><span class=p>[</span><span class=mi>7</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>10</span><span class=w> </span><span class=c1># max. invocations per second</span>
<span class=w>        </span><span class=n>descriptor</span><span class=p>[</span><span class=mi>8</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>52</span><span class=w> </span><span class=c1># db noisefloor -&gt; negative value</span>
<span class=w>        </span><span class=n>descriptor</span><span class=p>[</span><span class=mi>9</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=w>  </span><span class=c1># preemphasis</span>
<span class=w>        </span><span class=n>TFL</span><span class=p>.</span><span class=nf>begin</span><span class=p>(</span><span class=s2>&quot;MIC&quot;</span><span class=p>,</span><span class=n>descriptor</span><span class=p>)</span>
<span class=w>    </span><span class=k>end</span>

<span class=w>    </span><span class=kd>def</span><span class=w> </span><span class=nf>every_second</span><span class=p>()</span>
<span class=w>        </span><span class=k>if</span><span class=w> </span><span class=kr>self</span><span class=p>.</span><span class=na>secs</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>0</span>
<span class=w>            </span><span class=nb>print</span><span class=p>(</span><span class=kr>self</span><span class=p>.</span><span class=na>secs</span><span class=p>)</span>
<span class=w>            </span><span class=k>if</span><span class=w> </span><span class=kr>self</span><span class=p>.</span><span class=na>secs</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=nb>print</span><span class=p>(</span><span class=s2>&quot;... done!&quot;</span><span class=p>)</span><span class=w> </span><span class=k>end</span>
<span class=w>            </span><span class=kr>self</span><span class=p>.</span><span class=na>secs</span><span class=w> </span><span class=o>-=</span><span class=w> </span><span class=mi>1</span>
<span class=w>        </span><span class=k>end</span>
<span class=w>    </span><span class=k>end</span>

<span class=w>    </span><span class=kd>def</span><span class=w> </span><span class=nf>every_100ms</span><span class=p>()</span>
<span class=w>        </span><span class=kr>import</span><span class=w> </span><span class=n>TFL</span>
<span class=w>        </span><span class=kd>var</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>TFL</span><span class=p>.</span><span class=nf>log</span><span class=p>()</span>
<span class=w>        </span><span class=k>if</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=nb>print</span><span class=p>(</span><span class=n>s</span><span class=p>)</span><span class=w> </span><span class=k>end</span>
<span class=w>    </span><span class=k>end</span>

<span class=w>    </span><span class=kd>def</span><span class=w> </span><span class=nf>rec</span><span class=p>(</span><span class=n>name</span><span class=p>,</span><span class=n>secs</span><span class=p>)</span>
<span class=w>        </span><span class=kr>import</span><span class=w> </span><span class=n>TFL</span>
<span class=w>        </span><span class=kr>self</span><span class=p>.</span><span class=nf>begin</span><span class=p>()</span>
<span class=w>        </span><span class=n>TFL</span><span class=p>.</span><span class=nf>rec</span><span class=p>(</span><span class=n>name</span><span class=p>,</span><span class=n>secs</span><span class=p>)</span><span class=w> </span><span class=c1># Edgeimpulse can infer the label from the name, so name it accordingly</span>
<span class=w>        </span><span class=kr>self</span><span class=p>.</span><span class=na>secs</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>secs</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=c1># add startup latency</span>
<span class=w>        </span><span class=nb>print</span><span class=p>(</span><span class=s2>&quot;TFL: record&quot;</span><span class=p>,</span><span class=n>secs</span><span class=p>,</span><span class=s2>&quot;seconds to&quot;</span><span class=p>,</span><span class=n>name</span><span class=p>)</span>
<span class=w>    </span><span class=k>end</span>
<span class=k>end</span>

<span class=kd>var</span><span class=w> </span><span class=n>wav_rec</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>WAV_REC</span><span class=p>()</span>
<span class=n>tasmota</span><span class=p>.</span><span class=nf>add_driver</span><span class=p>(</span><span class=n>wav_rec</span><span class=p>)</span>

<span class=kd>def</span><span class=w> </span><span class=nf>rec</span><span class=p>(</span><span class=n>cmd</span><span class=p>,</span><span class=w> </span><span class=n>idx</span><span class=p>,</span><span class=w> </span><span class=n>payload</span><span class=p>,</span><span class=w> </span><span class=n>payload_json</span><span class=p>)</span>
<span class=w>    </span><span class=kd>var</span><span class=w> </span><span class=nb>file</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;/&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>payload</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s2>&quot;.wav&quot;</span>
<span class=w>    </span><span class=n>wav_rec</span><span class=p>.</span><span class=nf>rec</span><span class=p>(</span><span class=nb>file</span><span class=p>,</span><span class=n>idx</span><span class=p>)</span>
<span class=w>    </span><span class=n>tasmota</span><span class=p>.</span><span class=nf>resp_cmnd_str</span><span class=p>(</span><span class=nb>file</span><span class=p>)</span>
<span class=k>end</span>

<span class=n>tasmota</span><span class=p>.</span><span class=nf>add_cmd</span><span class=p>(</span><span class=s1>&#39;rec&#39;</span><span class=p>,</span><span class=w> </span><span class=n>rec</span><span class=p>)</span><span class=w> </span><span class=c1># rec30 left -&gt; record 30 seconds from I2S microphone to &quot;/left.wav&quot;</span>
</code></pre></div> <div class="admonition note"> <p class=admonition-title>Most of the descriptor values do not really matter here, but the whole descriptor must have valid values, meaning some values MUST not be 0!</p> </div> <p>Then you can talk into the microphone with around 1 word per second and later upload this file to your <a href=https://www.edgeimpulse.com/ >Edge Impulse</a> project via your computer.</p> <h3 id=general-strategies>General strategies<a class=headerlink href=#general-strategies title="Permanent link">~</a></h3> <ol> <li>Mix input samples from different microphones. Using the computer or phone for audio recording is way more user friendly, so add some samples the easy way. But without enough samples from your ESP32 microphone the final performance will be mediocre at best.</li> <li>Input samples from different speakers will very likely lead to a more robust model. So ask family and friends for help.</li> <li>More is more. Almost always adding more samples will result in a better performing model. Don't give up, if testing performance degrades in the early stages of audio harvesting. Just make sure to only add valid audio data with correct labels and the final result will improve with more audio data.</li> </ol> <h3 id=edge-impulse>Edge Impulse<a class=headerlink href=#edge-impulse title="Permanent link">~</a></h3> <p>For training on <a href=https://www.edgeimpulse.com/ >Edge Impulse</a> some post processing is usually necessary. </p> <p>If you have uploaded a sample containing many repetitions of one word, there is a convenient split function, that slices the long mega-sample into one-second samples. For very short words this works automatically pretty well, for longer words close to one second it is recommended to check and fix possible errors immediately.<br> You can check the resulting simple sample including the correct label: </p> <figcaption>16-bit-sample with label "computer":</figcaption> <p><img alt="Final sample" src=../_media/ml/audio_file.jpg></p> <p>The feature extraction step needs some parameters and will happen in the same way before training and later on-device. </p> <figcaption>MFCC parameters:</figcaption> <p><img alt="Feature parameters" src=../_media/ml/feature_parameters.png width=500></p> <p>This will create a feature array, which will stack the features of every slice on each other. This will be visualized as a heat map, where a slice is a column (oldest left) and the lines represent the frequency banks. Thus this "picture" holds the data of one second of audio, that the ML model will later "see" to do inference. </p> <figcaption>MFCC features for 1 second of audio:</figcaption> <p><img alt="Feature map" src=../_media/ml/features.png></p> <p>Configuring the neural network architecture can be done in a GUI. Following the rule to go deep (more layers) and not too wide (less neurons) results in smaller models. </p> <figcaption>"Deep" model for 7 keywords (plus unknown and noise) with size of only 14 kB:</figcaption> <p><img alt="Neural network architecture" src=../_media/ml/nn_arch.png width=500></p> <p>After training and configuring the model on Edgeimpulse we can simply download the TensorFlow Lite model from the dashboard (the int8 version) and upload it to the ESP32 filesystem. </p> <h3 id=tasmota-side>Tasmota Side<a class=headerlink href=#tasmota-side title="Permanent link">~</a></h3> <p>On the Tasmota side the feature settings have to be translated in Berry with a descriptor. The descriptor settings may change in the future! </p> <table> <thead> <tr> <th>number</th> <th style="text-align: left;">property</th> <th style="text-align: left;">value</th> </tr> </thead> <tbody> <tr> <td>0</td> <td style="text-align: left;">i2s_channel_fmt_t</td> <td style="text-align: left;"><em>i2s_channel_fmt_t</em> from i2s_types.h, we need mono, so 3 for right or 4 for left</td> </tr> <tr> <td>1</td> <td style="text-align: left;">amplification factor</td> <td style="text-align: left;">typical values are 8 - 32, must be &gt;0, too high values will lead to clipping<br>The audio output of most I2S microphone is very low. Check your setup by recording a WAV file and analyze in Edgeimpulse or use an audio tool like <em>Audacity</em>.</td> </tr> <tr> <td>2</td> <td style="text-align: left;">slice duration<br><em>or</em> Frame length</td> <td style="text-align: left;">A slice of audio data in milliseconds. With the fixed audio settings 32 milliseconds translate to 512 samples, which as a power of 2 is a good fit for FFT.</td> </tr> <tr> <td>3</td> <td style="text-align: left;">slice stride<br><em>or</em> Frame stride</td> <td style="text-align: left;">Time in milliseconds between the starts of 2 adjacent slices. No overlap happens if duration and stride are equal. Lower values create more stress for the system. Values around and below 20 milliseconds may leads to problems. Bad Wifi will worsen things earlier!!</td> </tr> <tr> <td>4</td> <td style="text-align: left;">Filter number</td> <td style="text-align: left;">Number of captured mel energies. For MFE mode these are the feature values for one slice.</td> </tr> <tr> <td>5</td> <td style="text-align: left;">MFCC coefficients<br><em>or</em> Number of coefficients</td> <td style="text-align: left;">If not 0, this means we use MFCC mode and these are the feature values for one slice.</td> </tr> <tr> <td>6</td> <td style="text-align: left;">FFT size<br><em>or</em> FFT length</td> <td style="text-align: left;">In powers of 2. For now must be equal or greater than sample size, means slice duration of 32 ms -&gt; sample size 512 -&gt; 2^9 -&gt; 9</td> </tr> <tr> <td>7</td> <td style="text-align: left;">Inferences per second</td> <td style="text-align: left;">Typical values 4-10. More values need more averaging in post-processing, but will likely show less missed words.</td> </tr> <tr> <td>8</td> <td style="text-align: left;">Noisefloor</td> <td style="text-align: left;">In dB for MFE mode. Sound data with level below that threshold will be discarded.</td> </tr> <tr> <td>9</td> <td style="text-align: left;">preemphassis</td> <td style="text-align: left;">Factor will be divided by 100, so 98 -&gt; 0.98. It is recommended to not use this, as Edgeimpulse and Speechpy compute this over the whole sample, while Tasmota does this per slice, which is way more efficient but creates a difference. There is a way to overcome this. More later ...</td> </tr> </tbody> </table> <p>The Berry driver for the speech recognition must be adapted for every <em>model</em> and use case. A plain old ESP32 without extra PS-RAM is enough to "hear" with about 10 inferences per per second.</p> <p>Demo example:<br> <div class=highlight><pre><span></span><code><span class=c1># globals</span>
<span class=kd>var</span><span class=w> </span><span class=n>key_words</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;down&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;left&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;noise&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;right&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;up&quot;</span><span class=p>]</span><span class=w> </span><span class=c1># must match your trained model!! Edgeimpulse sorts them alphabetically</span>
<span class=kd>var</span><span class=w> </span><span class=n>thresholds</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>[</span><span class=mi>700</span><span class=p>,</span><span class=mi>710</span><span class=p>,</span><span class=mi>680</span><span class=p>,</span><span class=mi>680</span><span class=p>,</span><span class=mi>720</span><span class=p>]</span><span class=w> </span><span class=c1># same indices as key_words, increase against false positives, decrease against misses, </span>
<span class=w>                                       </span><span class=c1># max. theoretical value = 256 * number of averages for int8_t output tensor</span>

<span class=kd>class</span><span class=w> </span><span class=nc>PREDICTOR</span>
<span class=w>    </span><span class=kd>var</span><span class=w> </span><span class=n>avgs</span><span class=p>,</span><span class=w> </span><span class=n>sz</span><span class=p>,</span><span class=w> </span><span class=n>time_out</span>
<span class=w>    </span><span class=kd>var</span><span class=w> </span><span class=n>out_buf</span><span class=p>,</span><span class=w> </span><span class=n>out_buf_idx</span>

<span class=w>    </span><span class=kd>def</span><span class=w> </span><span class=nf>init</span><span class=p>(</span><span class=n>sz</span><span class=p>,</span><span class=w> </span><span class=n>averages</span><span class=p>)</span>
<span class=w>        </span><span class=kr>self</span><span class=p>.</span><span class=na>out_buf</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>bytes</span><span class=p>(</span><span class=o>-</span><span class=p>(</span><span class=n>averages</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>sz</span><span class=p>))</span><span class=w> </span><span class=c1># creates circular buffer for averaging</span>
<span class=w>        </span><span class=kr>self</span><span class=p>.</span><span class=na>out_buf_idx</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=w> </span>
<span class=w>        </span><span class=kr>self</span><span class=p>.</span><span class=na>time_out</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=w> </span><span class=c1># after successful word finding, make a break to avoid &quot;noise findings&quot;</span>
<span class=w>        </span><span class=kr>self</span><span class=p>.</span><span class=na>sz</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>sz</span><span class=w> </span><span class=c1># size of word list/output tensor</span>
<span class=w>        </span><span class=kr>self</span><span class=p>.</span><span class=na>avgs</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>averages</span><span class=w> </span><span class=c1># number of averaging/oversampling steps</span>
<span class=w>    </span><span class=k>end</span>

<span class=w>    </span><span class=kd>def</span><span class=w> </span><span class=nf>clear</span><span class=p>()</span><span class=w> </span><span class=c1># clear oversampling buffer after word was found</span>
<span class=w>        </span><span class=k>for</span><span class=w> </span><span class=n>i</span><span class=o>:</span><span class=mi>0</span><span class=o>..</span><span class=nb>size</span><span class=p>(</span><span class=kr>self</span><span class=p>.</span><span class=na>out_buf</span><span class=p>)</span><span class=mi>-1</span>
<span class=w>            </span><span class=kr>self</span><span class=p>.</span><span class=na>out_buf</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span>
<span class=w>        </span><span class=k>end</span>
<span class=w>    </span><span class=k>end</span>

<span class=w>    </span><span class=kd>def</span><span class=w> </span><span class=nf>run</span><span class=p>(</span><span class=n>data</span><span class=p>)</span>
<span class=w>        </span><span class=k>if</span><span class=w> </span><span class=kr>self</span><span class=p>.</span><span class=na>time_out</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>0</span>
<span class=w>            </span><span class=kr>self</span><span class=p>.</span><span class=na>time_out</span><span class=w> </span><span class=o>-=</span><span class=w> </span><span class=mi>1</span>
<span class=w>            </span><span class=k>return</span><span class=w> </span><span class=mi>255</span><span class=w> </span><span class=c1># return some error code = no result</span>
<span class=w>        </span><span class=k>end</span>

<span class=w>        </span><span class=k>for</span><span class=w> </span><span class=n>i</span><span class=o>:</span><span class=mi>0</span><span class=o>..</span><span class=p>(</span><span class=kr>self</span><span class=p>.</span><span class=na>sz</span><span class=mi>-1</span><span class=p>)</span>
<span class=w>            </span><span class=kr>self</span><span class=p>.</span><span class=na>out_buf</span><span class=p>[</span><span class=kr>self</span><span class=p>.</span><span class=na>out_buf_idx</span><span class=o>+</span><span class=n>i</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>data</span><span class=p>[</span><span class=n>i</span><span class=p>]</span>
<span class=w>        </span><span class=k>end</span>
<span class=w>        </span><span class=kr>self</span><span class=p>.</span><span class=na>out_buf_idx</span><span class=w> </span><span class=o>+=</span><span class=w> </span><span class=kr>self</span><span class=p>.</span><span class=na>sz</span>
<span class=w>        </span><span class=k>if</span><span class=w> </span><span class=kr>self</span><span class=p>.</span><span class=na>out_buf_idx</span><span class=o>&gt;</span><span class=p>(</span><span class=kr>self</span><span class=p>.</span><span class=na>avgs</span><span class=mi>-1</span><span class=p>)</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=kr>self</span><span class=p>.</span><span class=na>sz</span>
<span class=w>            </span><span class=kr>self</span><span class=p>.</span><span class=na>out_buf_idx</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=w> </span>
<span class=w>        </span><span class=k>end</span>

<span class=w>        </span><span class=kd>var</span><span class=w> </span><span class=n>average</span>
<span class=w>        </span><span class=k>for</span><span class=w> </span><span class=n>i</span><span class=o>:</span><span class=mi>0</span><span class=o>..</span><span class=p>(</span><span class=kr>self</span><span class=p>.</span><span class=na>sz</span><span class=mi>-1</span><span class=p>)</span>
<span class=w>            </span><span class=n>average</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span>
<span class=w>            </span><span class=k>for</span><span class=w> </span><span class=n>j</span><span class=o>:</span><span class=mi>0</span><span class=o>..</span><span class=kr>self</span><span class=p>.</span><span class=na>avgs</span><span class=mi>-1</span>
<span class=w>                </span><span class=n>average</span><span class=w> </span><span class=o>+=</span><span class=w>  </span><span class=kr>self</span><span class=p>.</span><span class=na>out_buf</span><span class=p>[</span><span class=n>i</span><span class=o>+</span><span class=p>(</span><span class=n>j</span><span class=o>*</span><span class=kr>self</span><span class=p>.</span><span class=na>sz</span><span class=p>)]</span>
<span class=w>            </span><span class=k>end</span>
<span class=w>            </span><span class=c1># if i == 4</span>
<span class=w>            </span><span class=c1>#     print(average) # test the threshold for single words while developing, needed in the next step</span>
<span class=w>            </span><span class=c1># end</span>
<span class=w>            </span><span class=k>if</span><span class=w> </span><span class=n>average</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=n>thresholds</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=w> </span><span class=c1># find the threshold stored in the global list by trial and error</span>
<span class=w>                </span><span class=k>if</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=mi>2</span><span class=w> </span><span class=c1># this is the non-noise/unknown output - you must infer this from your model</span>
<span class=w>                    </span><span class=kr>self</span><span class=p>.</span><span class=nf>clear</span><span class=p>()</span><span class=w> </span><span class=c1># only clear the buffer after finding a keyword, not for noise/unknown</span>
<span class=w>                    </span><span class=kr>self</span><span class=p>.</span><span class=na>time_out</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>10</span><span class=w> </span><span class=c1># find the value by trial and error - good starting point is one second</span>
<span class=w>                                       </span><span class=c1># lower number allows faster speech, but might increase false positives</span>
<span class=w>                    </span><span class=nb>print</span><span class=p>(</span><span class=n>average</span><span class=p>)</span>
<span class=w>                </span><span class=k>end</span>
<span class=w>                </span><span class=k>return</span><span class=w> </span><span class=n>i</span>
<span class=w>            </span><span class=k>end</span>
<span class=w>        </span><span class=k>end</span>
<span class=w>        </span><span class=k>return</span><span class=w> </span><span class=mi>255</span><span class=w> </span><span class=c1># return some error code = no result</span>
<span class=w>    </span><span class=k>end</span>
<span class=k>end</span>

<span class=kd>class</span><span class=w> </span><span class=nc>MICROSPEECH</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>Driver</span>
<span class=w>    </span><span class=kd>var</span><span class=w> </span><span class=n>o</span><span class=p>,</span><span class=w> </span><span class=n>o_sz</span><span class=w>  </span><span class=c1># output tensor, size of output tensor</span>
<span class=w>    </span><span class=kd>var</span><span class=w> </span><span class=n>p</span><span class=w>        </span><span class=c1># predictor instance</span>
<span class=w>    </span><span class=kd>var</span><span class=w> </span><span class=n>model</span><span class=w>    </span><span class=c1># this var really holds the model data for the entire session</span>
<span class=w>    </span><span class=kd>var</span><span class=w> </span><span class=n>new_out</span><span class=w>  </span><span class=c1># current output sensor converted to uint8_t</span>

<span class=w>    </span><span class=kd>def</span><span class=w> </span><span class=nf>init</span><span class=p>()</span>
<span class=w>        </span><span class=kr>import</span><span class=w> </span><span class=n>TFL</span>
<span class=w>        </span><span class=kr>self</span><span class=p>.</span><span class=na>o_sz</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>size</span><span class=p>(</span><span class=n>key_words</span><span class=p>)</span><span class=w> </span><span class=c1># this value must be correctly taken from the model/training pipeline</span>
<span class=w>        </span><span class=kr>self</span><span class=p>.</span><span class=na>new_out</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>[]</span>
<span class=w>        </span><span class=kr>self</span><span class=p>.</span><span class=na>new_out</span><span class=p>.</span><span class=nf>resize</span><span class=p>(</span><span class=kr>self</span><span class=p>.</span><span class=na>o_sz</span><span class=p>)</span>
<span class=w>        </span><span class=kr>self</span><span class=p>.</span><span class=na>o</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>bytes</span><span class=p>(</span><span class=o>-</span><span class=kr>self</span><span class=p>.</span><span class=na>o_sz</span><span class=p>)</span><span class=w> </span><span class=c1># size must match the model</span>
<span class=w>        </span><span class=kr>self</span><span class=p>.</span><span class=na>p</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>PREDICTOR</span><span class=p>(</span><span class=kr>self</span><span class=p>.</span><span class=na>o_sz</span><span class=p>,</span><span class=mi>4</span><span class=p>)</span><span class=w> </span><span class=c1># second arg is number of averages for prediction</span>

<span class=w>        </span><span class=kd>var</span><span class=w> </span><span class=n>descriptor</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>bytes</span><span class=p>(</span><span class=mi>-10</span><span class=p>)</span>
<span class=w>        </span><span class=n>descriptor</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>4</span><span class=w>  </span><span class=c1># i2s_channel_fmt, 4=left</span>
<span class=w>        </span><span class=n>descriptor</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>16</span><span class=w> </span><span class=c1># amplification factor</span>
<span class=w>        </span><span class=n>descriptor</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>32</span><span class=w> </span><span class=c1># slice_dur in ms </span>
<span class=w>        </span><span class=n>descriptor</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>32</span><span class=w> </span><span class=c1># slice_stride in ms</span>
<span class=w>        </span><span class=n>descriptor</span><span class=p>[</span><span class=mi>4</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>26</span><span class=w> </span><span class=c1># mfe filter (= features if MFE mode)</span>
<span class=w>        </span><span class=n>descriptor</span><span class=p>[</span><span class=mi>5</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>13</span><span class=w> </span><span class=c1># mfcc coefficients, if 0 -&gt; compute MFE only</span>
<span class=w>        </span><span class=n>descriptor</span><span class=p>[</span><span class=mi>6</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>9</span><span class=w>  </span><span class=c1># 2^9 = 512 fft_bins</span>
<span class=w>        </span><span class=n>descriptor</span><span class=p>[</span><span class=mi>7</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>10</span><span class=w> </span><span class=c1># max. invocations per second - find best value by testing on device</span>
<span class=w>        </span><span class=n>descriptor</span><span class=p>[</span><span class=mi>8</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>52</span><span class=w> </span><span class=c1># db noisefloor -&gt; negative value</span>
<span class=w>        </span><span class=n>descriptor</span><span class=p>[</span><span class=mi>9</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=w> </span><span class=c1># preemphasis</span>
<span class=w>        </span><span class=n>TFL</span><span class=p>.</span><span class=nf>begin</span><span class=p>(</span><span class=s2>&quot;MIC&quot;</span><span class=p>,</span><span class=n>descriptor</span><span class=p>)</span>
<span class=w>        </span><span class=kr>self</span><span class=p>.</span><span class=na>model</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>open</span><span class=p>(</span><span class=s2>&quot;mfcc.lite&quot;</span><span class=p>).</span><span class=nf>readbytes</span><span class=p>()</span><span class=w> </span><span class=c1># file must be present on the ESP</span>
<span class=w>        </span><span class=k>if</span><span class=w> </span><span class=kr>self</span><span class=p>.</span><span class=na>model</span>
<span class=w>            </span><span class=n>TFL</span><span class=p>.</span><span class=nf>load</span><span class=p>(</span><span class=kr>self</span><span class=p>.</span><span class=na>model</span><span class=p>,</span><span class=kr>self</span><span class=p>.</span><span class=na>o</span><span class=p>,</span><span class=mi>28000</span><span class=p>)</span>
<span class=w>        </span><span class=k>end</span>
<span class=w>    </span><span class=k>end</span>

<span class=w>    </span><span class=kd>def</span><span class=w> </span><span class=nf>every_50ms</span><span class=p>()</span>
<span class=w>        </span><span class=kr>import</span><span class=w> </span><span class=n>TFL</span>
<span class=w>        </span><span class=k>if</span><span class=w> </span><span class=n>TFL</span><span class=p>.</span><span class=nf>output</span><span class=p>(</span><span class=kr>self</span><span class=p>.</span><span class=na>o</span><span class=p>)</span>
<span class=w>            </span><span class=k>for</span><span class=w> </span><span class=n>i</span><span class=o>:</span><span class=mi>0</span><span class=o>..</span><span class=p>(</span><span class=kr>self</span><span class=p>.</span><span class=na>o_sz</span><span class=mi>-1</span><span class=p>)</span>
<span class=w>                </span><span class=kr>self</span><span class=p>.</span><span class=na>new_out</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kr>self</span><span class=p>.</span><span class=na>o</span><span class=p>.</span><span class=nf>geti</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=mi>1</span><span class=p>)</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mi>128</span>
<span class=w>            </span><span class=k>end</span>
<span class=w>            </span><span class=c1>#print(self.new_out)</span>
<span class=w>            </span><span class=kd>var</span><span class=w> </span><span class=n>r</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kr>self</span><span class=p>.</span><span class=na>p</span><span class=p>.</span><span class=nf>run</span><span class=p>(</span><span class=kr>self</span><span class=p>.</span><span class=na>new_out</span><span class=p>)</span>
<span class=w>            </span><span class=k>if</span><span class=w> </span><span class=n>r</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=mi>2</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=n>r</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=mi>255</span><span class=w> </span><span class=c1># in this example not noise/unknown/error code - can be more complex</span>
<span class=w>                </span><span class=nb>print</span><span class=p>(</span><span class=n>key_words</span><span class=p>[</span><span class=n>r</span><span class=p>])</span>
<span class=w>                </span><span class=c1># do something useful</span>
<span class=w>            </span><span class=k>end</span>
<span class=w>        </span><span class=k>end</span>
<span class=w>        </span><span class=kd>var</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>TFL</span><span class=p>.</span><span class=nf>log</span><span class=p>()</span>
<span class=w>        </span><span class=k>if</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=nb>print</span><span class=p>(</span><span class=n>s</span><span class=p>)</span><span class=w> </span><span class=k>end</span>
<span class=w>    </span><span class=k>end</span>
<span class=k>end</span>

<span class=kd>var</span><span class=w> </span><span class=n>mic</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>MICROSPEECH</span><span class=p>()</span>

<span class=n>tasmota</span><span class=p>.</span><span class=nf>add_driver</span><span class=p>(</span><span class=n>mic</span><span class=p>)</span>
</code></pre></div></p> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg> Back to top </button> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://discord.gg/Ks2Kzd4 target=_blank rel=noopener title=discord.gg class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 640 512"><!-- Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M524.531 69.836a1.5 1.5 0 0 0-.764-.7A485.065 485.065 0 0 0 404.081 32.03a1.816 1.816 0 0 0-1.923.91 337.461 337.461 0 0 0-14.9 30.6 447.848 447.848 0 0 0-134.426 0 309.541 309.541 0 0 0-15.135-30.6 1.89 1.89 0 0 0-1.924-.91 483.689 483.689 0 0 0-119.688 37.107 1.712 1.712 0 0 0-.788.676C39.068 183.651 18.186 294.69 28.43 404.354a2.016 2.016 0 0 0 .765 1.375 487.666 487.666 0 0 0 146.825 74.189 1.9 1.9 0 0 0 2.063-.676A348.2 348.2 0 0 0 208.12 430.4a1.86 1.86 0 0 0-1.019-2.588 321.173 321.173 0 0 1-45.868-21.853 1.885 1.885 0 0 1-.185-3.126 251.047 251.047 0 0 0 9.109-7.137 1.819 1.819 0 0 1 1.9-.256c96.229 43.917 200.41 43.917 295.5 0a1.812 1.812 0 0 1 1.924.233 234.533 234.533 0 0 0 9.132 7.16 1.884 1.884 0 0 1-.162 3.126 301.407 301.407 0 0 1-45.89 21.83 1.875 1.875 0 0 0-1 2.611 391.055 391.055 0 0 0 30.014 48.815 1.864 1.864 0 0 0 2.063.7A486.048 486.048 0 0 0 610.7 405.729a1.882 1.882 0 0 0 .765-1.352c12.264-126.783-20.532-236.912-86.934-334.541ZM222.491 337.58c-28.972 0-52.844-26.587-52.844-59.239s23.409-59.241 52.844-59.241c29.665 0 53.306 26.82 52.843 59.239 0 32.654-23.41 59.241-52.843 59.241Zm195.38 0c-28.971 0-52.843-26.587-52.843-59.239s23.409-59.241 52.843-59.241c29.667 0 53.307 26.82 52.844 59.239 0 32.654-23.177 59.241-52.844 59.241Z"/></svg> </a> <a href=https://t.me/tasmota target=_blank rel=noopener title=t.me class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M248 8C111.033 8 0 119.033 0 256s111.033 248 248 248 248-111.033 248-248S384.967 8 248 8Zm114.952 168.66c-3.732 39.215-19.881 134.378-28.1 178.3-3.476 18.584-10.322 24.816-16.948 25.425-14.4 1.326-25.338-9.517-39.287-18.661-21.827-14.308-34.158-23.215-55.346-37.177-24.485-16.135-8.612-25 5.342-39.5 3.652-3.793 67.107-61.51 68.335-66.746.153-.655.3-3.1-1.154-4.384s-3.59-.849-5.135-.5q-3.283.746-104.608 69.142-14.845 10.194-26.894 9.934c-8.855-.191-25.888-5.006-38.551-9.123-15.531-5.048-27.875-7.717-26.8-16.291q.84-6.7 18.45-13.7 108.446-47.248 144.628-62.3c68.872-28.647 83.183-33.623 92.511-33.789 2.052-.034 6.639.474 9.61 2.885a10.452 10.452 0 0 1 3.53 6.716 43.765 43.765 0 0 1 .417 9.769Z"/></svg> </a> <a href=https://github.com/tasmota target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 480 512"><!-- Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "..", "features": ["navigation.instant", "navigation.tabs", "navigation.tabs.sticky", "navigation.top", "navigation.tracking", "content.action.edit"], "search": "../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script> <script src=../assets/javascripts/bundle.bd41221c.min.js></script> <script src=https://unpkg.com/tablesort@5.3.0/dist/tablesort.min.js></script> <script src=../extra_javascript/tablesort.js></script> </body> </html>